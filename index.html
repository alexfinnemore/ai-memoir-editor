<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Previous head content remains the same -->
</head>
<body>
    <!-- Previous body content remains the same until the script tag -->

    <script>
        function getHighlightClass(type) {
            type = type.toLowerCase();
            if (type.includes('grammar')) return 'highlight-grammar';
            if (type.includes('spelling')) return 'highlight-spelling';
            if (type.includes('style')) return 'highlight-style';
            return 'highlight-other';
        }

        function highlightTextInPlace(text, searchText, className) {
            if (!searchText || !text) return text;
            // Escape regex special characters
            const escapedSearchText = searchText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const regex = new RegExp(`(${escapedSearchText})`, 'g');
            return text.replace(regex, `<span class="${className}">$1</span>`);
        }

        function displayChanges(result) {
            console.log('Displaying changes:', result);
            
            // Display AI-reported changes
            const aiChangesHtml = result.aiChanges.map(change => {
                const highlightClass = getHighlightClass(change.type);
                return `
                    <div class="change-item">
                        <div class="change-type">${change.type}</div>
                        <div class="change-text">Before: ${change.before}</div>
                        <div class="change-text">After: <span class="${highlightClass}">${change.after}</span></div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('ai-changes').innerHTML = aiChangesHtml;

            // Highlight changes in the edited text
            let highlightedText = result.editedText;
            result.aiChanges.forEach(change => {
                const highlightClass = getHighlightClass(change.type);
                highlightedText = highlightTextInPlace(highlightedText, change.after, highlightClass);
            });

            document.getElementById('edited-display').innerHTML = highlightedText;
        }

        // Rest of your script remains the same
    </script>
</body>
</html>